<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="welcome">

    <select id="getEnvironment" resultType="HashMap" parameterType="HashMap">
        SELECT COUNT(0) total,
		    sum(case when result='1' then 1 else 0 end) notest,
		    sum(case when result='2' then 1 else 0 end) negative,
		    sum(case when result='3' then 1 else 0 end) positive,
		    ROUND(sum(case when result!='1' then 1 else 0 end)/count(0)*100,2) pc
        FROM bs_environment where flag = 1
        <trim prefix="AND" prefixOverrides="AND">
            <if test="areaProvince != null">
                AND province_id = #{areaProvince}
            </if>
            <if test="areaCity != null">
                AND city_id = #{areaCity}
            </if>
            <if test="areaCounty != null">
                AND county_id = #{areaCounty}
            </if>
        </trim>
    </select>

    <select id="getEmployee" resultType="HashMap" parameterType="HashMap">
         SELECT COUNT(0) total,
		 sum(case when result='1' then 1 else 0 end) notest,
		 sum(case when result='2' then 1 else 0 end) negative,
		 sum(case when result='3' then 1 else 0 end) positive,
		 ROUND(sum(case when result!='1' then 1 else 0 end)/count(0)*100,2)pc
         FROM bs_employee where flag = 1
        <trim prefix="AND" prefixOverrides="AND">
            <if test="areaProvince != null">
                AND province_id = #{areaProvince}
            </if>
            <if test="areaCity != null">
                AND city_id = #{areaCity}
            </if>
            <if test="areaCounty != null">
                AND county_id = #{areaCounty}
            </if>
        </trim>
    </select>

    <select id="getCrowdTotal" resultType="HashMap" parameterType="HashMap">
        SELECT
            SUM(sampling_total) sampling_total,
            SUM(detection_total) detection_total,
            SUM(masculine_total) positive,
            ROUND(SUM(detection_total)/SUM(sampling_total)*100,2)pc
        from bs_crowd_total b where flag = 1
        <trim prefix="AND" prefixOverrides="AND">
            <if test="areaProvince != null">
                AND province_id = #{areaProvince}
            </if>
            <if test="areaCity != null">
                AND city_id = #{areaCity}
            </if>
            <if test="areaCounty != null">
                AND county_id = #{areaCounty}
            </if>
        </trim>
    </select>
</mapper>